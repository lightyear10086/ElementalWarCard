<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
    <title>游戏</title>
    
    <style>
        .mapgirddiv{
            width:30px;
            height:30px;
            border:solid 1px;
            position:absolute;
        }
    </style>
</head>
<body>
    <div id="gameinit">
        <button id="matchgame">匹配</button>
    </div>
    <div id="gamescene">
        敌人血量
        <div id="enamylife"></div>
        你的血量
        <div id="playerlife"></div>
        <div id="Mapdiv"></div>
        <button id="attack">攻击</button>
        <button id="exercise">锻炼</button>
        <button id="turnend">结束回合</button>
        <div id="playerinfo"></div>
    </div>

    <script src="/socket.io/socket.io.js">
    </script>
    <script>
        var socket=io();
        var enamyid="";
        var playerid="";
        $(function(){
            for(let i=0;i<10;i++){
                for(let j=0;j<10;j++){
                    $("#Mapdiv").append("<div id='"+i+"_"+j+"' class='mapgirddiv' style='left:"+(i*30)+"px;top:"+(j*30+300)+"px;'></div>");
                }
            }

            $("#gamescene").hide();
            $("#matchgame").click(function(){
                console.log("begin match");
                socket.emit('action',{
                    'name':'matchgame'
                });
            });
            $("#attack").click(function(){
                socket.emit('action',{
                    'name':"attack"
                })
            });
            $("#turnend").click(function(){
                socket.emit('action',{
                    'name':"turnend"
                });
                $("#attack").hide();
                $("#turnend").hide();
            })
            $("#exercise").click(function(){
                socket.emit('action',{
                    'name':'exercise'
                })
            })
        });

        socket.on('action',function(msg){
            console.log(msg);
            if(msg.name=='draw'){
                
            }
            if(msg.name=='syncmap'){
                let grid=msg.grid;
                if(grid.master.id==enamyid){
                    $("#"+grid.posx+"_"+grid.posy).css("background-color","red");
                }else if(grid.master.id==playerid){
                    $("#"+grid.posx+"_"+grid.posy).css("background-color","green");
                }
            }
            if(msg.name=='turnbegin'){
                console.log("回合开始");
                $("#attack").show();
                $("#turnend").show();
            }
            if(msg.name=='matchenamy'){
                $("#gamescene").show();
                $("#gameinit").hide();
                $("#attack").hide();
                $("#turnend").hide();
            }
            if(msg.name=="updatelife"){
                $("#playerlife").text(msg.life);
            }
            if(msg.name=='updateinfo'){
                $("#playerinfo").html("攻击力 "+msg.info.attackforce+"<br>行动点 "+msg.info.active+"<br>暴击率 "+msg.info.critrate);
            }
            if(msg.name=="updateenamylife"){
                $("#enamylife").text(msg.life);
            }
            if(msg.name=='gameresult'){
                switch(msg.res){
                    case 0:
                        alert("你输了");
                        break;
                    case 1:
                        alert("胜利！");
                        break;
                    case 2:
                        alert("平局！");
                        break;
                }
                $("#gamescene").hide();
                $("#gameinit").show();
            }
        })
    </script>
</body>
</html>